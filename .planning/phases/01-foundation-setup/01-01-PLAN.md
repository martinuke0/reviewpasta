---
phase: 01-foundation-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [package.json, package-lock.json, wrangler.toml]
autonomous: true
user_setup:
  - service: cloudflare
    why: "D1 database and Workers hosting"
    env_vars: []
    dashboard_config:
      - task: "Create Cloudflare account if needed"
        location: "https://dash.cloudflare.com"

must_haves:
  truths:
    - "Wrangler CLI is installed and working"
    - "D1 database exists with businesses table"
    - "Schema matches Supabase structure"
  artifacts:
    - path: "wrangler.toml"
      provides: "Cloudflare Workers configuration"
      min_lines: 10
    - path: "migrations/0001_create_businesses_table.sql"
      provides: "D1 database schema"
      contains: "CREATE TABLE businesses"
  key_links:
    - from: "wrangler.toml"
      to: "D1 database"
      via: "database_id binding"
      pattern: "database_id.*=.*"
---

<objective>
Install Wrangler CLI and create D1 database with businesses table schema

Purpose: Foundation for Cloudflare infrastructure - CLI tools and database
Output: Working Wrangler installation, configured D1 database with schema
</objective>

<execution_context>
@/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Wrangler and initialize project</name>
  <files>package.json, package-lock.json, wrangler.toml</files>
  <action>
    Install Wrangler CLI as dev dependency and create initial wrangler.toml configuration:
    1. Run `npm install --save-dev wrangler@latest` to add Wrangler
    2. Run `npx wrangler login` to authenticate with Cloudflare (may open browser)
    3. Create `wrangler.toml` with basic Workers configuration:
       - name: "reviewpasta-api"
       - main: "src/worker.ts" (will create in Plan 02)
       - compatibility_date: Use today's date
       - node_compat: true for Node.js compatibility

    The wrangler.toml should have placeholder for D1 database binding that we'll update in Task 2.
  </action>
  <verify>npx wrangler --version shows version 3.x</verify>
  <done>Wrangler CLI installed and wrangler.toml exists with basic configuration</done>
</task>

<task type="auto">
  <name>Task 2: Create D1 database with businesses schema</name>
  <files>wrangler.toml, migrations/0001_create_businesses_table.sql</files>
  <action>
    Create D1 database and define businesses table schema:
    1. Run `npx wrangler d1 create reviewpasta-db` to create database
    2. Copy the database_id from output
    3. Update wrangler.toml to add D1 binding:
       [[d1_databases]]
       binding = "DB"
       database_name = "reviewpasta-db"
       database_id = "{copied_id}"

    4. Create `migrations/0001_create_businesses_table.sql` with schema:
       CREATE TABLE IF NOT EXISTS businesses (
         id TEXT PRIMARY KEY,
         name TEXT NOT NULL,
         slug TEXT UNIQUE NOT NULL,
         place_id TEXT,
         location TEXT,
         description TEXT,
         created_at TEXT NOT NULL DEFAULT (datetime('now'))
       );
       CREATE INDEX idx_businesses_slug ON businesses(slug);
       CREATE INDEX idx_businesses_created_at ON businesses(created_at);

    5. Run migration: `npx wrangler d1 execute reviewpasta-db --file=migrations/0001_create_businesses_table.sql`
    6. Verify table exists: `npx wrangler d1 execute reviewpasta-db --command="SELECT name FROM sqlite_master WHERE type='table'"`
  </action>
  <verify>npx wrangler d1 execute reviewpasta-db --command="PRAGMA table_info(businesses)" shows table structure</verify>
  <done>D1 database created with businesses table matching Supabase schema</done>
</task>

</tasks>

<verification>
1. Wrangler CLI responds to commands: `npx wrangler --version`
2. D1 database exists: `npx wrangler d1 list` shows reviewpasta-db
3. Businesses table has correct schema: `npx wrangler d1 execute reviewpasta-db --command="PRAGMA table_info(businesses)"`
4. wrangler.toml has D1 database binding configured
</verification>

<success_criteria>
- Wrangler CLI installed and authenticated
- D1 database "reviewpasta-db" created
- Businesses table with correct schema exists
- wrangler.toml configured with database binding
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-01-SUMMARY.md`
</output>