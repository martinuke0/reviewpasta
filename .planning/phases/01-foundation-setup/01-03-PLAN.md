---
phase: 01-foundation-setup
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified: [.env.example, .gitignore]
autonomous: false
user_setup:
  - service: openrouter
    why: "AI review generation"
    env_vars:
      - name: OPENROUTER_API_KEY
        source: "OpenRouter Dashboard -> API Keys"
    dashboard_config: []

must_haves:
  truths:
    - "OpenRouter API key configured in Workers"
    - "Frontend builds and deploys to Pages"
    - "Auto-deploy triggers on git push"
  artifacts:
    - path: ".env.example"
      provides: "Environment variable documentation"
      contains: "OPENROUTER_API_KEY"
    - path: ".gitignore"
      provides: "Wrangler artifacts ignored"
      contains: ".wrangler"
  key_links:
    - from: "Workers secrets"
      to: "OpenRouter API"
      via: "wrangler secret"
      pattern: "OPENROUTER_API_KEY"
    - from: "git push"
      to: "Pages deployment"
      via: "Cloudflare Pages CI/CD"
      pattern: "production-branch.*main"
---

<objective>
Configure secrets and verify complete deployment pipeline

Purpose: Final setup for OpenRouter API access and deployment verification
Output: Secrets configured, successful build and deploy, auto-deploy working
</objective>

<execution_context>
@/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-foundation-setup/01-01-SUMMARY.md
@.planning/phases/01-foundation-setup/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure OpenRouter API secret</name>
  <files>.env.example, .gitignore</files>
  <action>
    Set up OpenRouter API key as Workers secret:
    1. Update .env.example to document new environment variables:
       - Add OPENROUTER_API_KEY=your_openrouter_api_key_here
       - Add comment explaining it's for AI review generation

    2. Update .gitignore to exclude Wrangler artifacts:
       - Add .wrangler/
       - Add .dev.vars (local secrets file)

    3. Set the secret in Workers (will prompt for value):
       `npx wrangler secret put OPENROUTER_API_KEY`
       Note: User will need to paste their OpenRouter API key when prompted

    4. Create .dev.vars file for local development (not committed):
       OPENROUTER_API_KEY=sk-or-v1-xxx (user's actual key)
  </action>
  <verify>npx wrangler secret list shows OPENROUTER_API_KEY</verify>
  <done>OpenRouter API key configured as Workers secret</done>
</task>

<task type="auto">
  <name>Task 2: Test build and initial deployment</name>
  <files></files>
  <action>
    Verify the entire build and deployment pipeline:
    1. Run production build: `npm run build`
       - Should complete without errors
       - Should generate dist/ folder with index.html and assets

    2. Deploy Workers API: `npm run deploy:worker`
       - Should deploy to Cloudflare Workers
       - Note the deployed URL for testing

    3. Deploy Pages frontend: `npm run deploy:pages`
       - Should upload dist/ folder to Cloudflare Pages
       - Note the Pages URL (e.g., reviewpasta.pages.dev)

    4. Test auto-deploy by making a small commit:
       - Update README.md with "Deployed to Cloudflare Pages"
       - Commit and push to main branch
       - Check Cloudflare dashboard for deployment trigger
  </action>
  <verify>curl https://reviewpasta.pages.dev returns HTML content</verify>
  <done>Build succeeds and both Workers and Pages are deployed</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Cloudflare infrastructure setup</what-built>
  <how-to-verify>
    1. Visit deployed Pages URL: https://reviewpasta.pages.dev (or custom URL shown in dashboard)
    2. Check Workers deployment: npx wrangler deploy --dry-run
    3. Verify auto-deploy in Cloudflare dashboard:
       - Go to Workers & Pages -> reviewpasta
       - Check "Deployments" tab for recent deployment from git
    4. Confirm secrets configured: npx wrangler secret list
    5. Test that frontend loads (may show errors since API not yet implemented)
  </how-to-verify>
  <resume-signal>Type "approved" if deployment successful, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Build completes: `npm run build` succeeds
2. Workers deployed: `npx wrangler deploy --dry-run` shows configuration
3. Pages deployed: Frontend accessible at Pages URL
4. Secrets configured: `npx wrangler secret list` shows OPENROUTER_API_KEY
5. Auto-deploy works: Git push triggers new deployment
</verification>

<success_criteria>
- Frontend successfully deploys to Cloudflare Pages with HTTPS
- Auto-deploy triggers on git push to main branch
- D1 database exists with correct schema
- OpenRouter API key configured in Workers secrets
- Wrangler configuration complete
- Build produces deployable artifacts
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-03-SUMMARY.md`
</output>